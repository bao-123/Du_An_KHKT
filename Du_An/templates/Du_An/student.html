<!--TODO: fix this-->
{% extends 'Du_An/layout.html' %}
{% load static %}
{% load tags %}

{% block title %}{{ student.full_name }}{% endblock %}
<!--* Replace if you wish-->
{% block style %}<link href="{% static 'Du_An/css/profile.css' %}" rel="stylesheet">{% endblock %}
{% block script %} <script src="{% static 'Du_An/js/profile.js' %}" type="module"></script> {% endblock %}

{% block body %}
    <div class="student_profile">
        <!--* Display the basic information -->
        <div class="basicInfo">
            <!---I student is a 'Student' instance -->
            <!---I student_profile is a 'studentYearProfile' instance -->
            <!---I student_profile.classroom is a 'ClassYearProfile' instance -->
            <h2 class="studentName"> {{ student.full_name }} </h2>
            <p class="studentClass">Lớp: <a href="{% url 'view_class' student_profile.classroom.classroom.id %}" class="link-info link-offset-2 link-opacity-75-hover">{{ student_profile.classroom.classroom.name }}</a></p>
            <p class="studentGender">Giới tính: {% if student.is_boy %} Nam {% else %} Nữ {% endif %}</p>
            <p class="studentRole">Chức vụ: {{ student_profile.role }}</p>
            <p class="studentParent">
                Phụ huynh: 
                {% for parent in student.parent.all %}
                <!--TODO: replace the href (to the parent's page)-->
                    <a href="{% url 'view_parent' parent.id %}" class="link-info link-offset-2 link-underline-dark link-opacity-75-hover"> {{ parent.full_name }}</a>,
                {% empty %}
                    Học sinh này chưa có phụ huynh nào nhận
                {% endfor %}
            </p>
        </div>
        <!--* show student's marks -->
        <div class="studentMark">
            {% if is_teaching %}
                <button class="btn btn-primary" id="updateMark">Cap nhap diem</button>
            {% endif %}
            <!--TODO: Add javascript to display the marks base on the selected subject-->
            <select id="subjects_select" class="form-condivol mx-2 me-auto">
                <!--** Default subject is Toán -->
                <option selected disabled>Môn học</option>
                {% for subject in subjects %}
                <option value="{{ subject.name }}"> {{ subject.name }} </option>
                {% endfor %}
            </select>
            <div class="subjectMark">
                    <h2>Bang diem</h2>
                <div>
                    Chon mon de xem diem
                </div>
                <!--TODO: fix this-->
                <!--** main subjects (4 thuong xuyen)-->
                <!--* get_subjects_mark without 'year' parameters will return the marks of this year -->
                {% for subject in student.get_subjects_mark.main %}
                    <div id="{{ subject.first_term.name }}" style="display: none;" class="subjectMarkDisplay">
                        <div class="subject_name_container">
                            <!--TODO: fix this-->
                            <p class="subject_name">{{ subject.first_term.name }}</p>
                        </div>
                        <div>
                            <p class="term_headers">Kì 1</p>
                        </div>

                        <div class="mark_table_headers">
                            <p>Điểm thường xuyên 1 </p>
                            <p>Điểm thường xuyên 2</p>
                            <p>Điểm thường xuyên 3</p>
                            <p>Điểm thường xuyên 4</p>
                            <p>Điểm giữa kì</p>
                            <p>Điểm cuối kì</p>
                        </div>

                        <!--* Hiển thị điểm-->
                        <div class="marks">
                            <div class="thuong_xuyen diem"> 
                                {% if subject.first_term.diem_thuong_xuyen1 %}
                                {{ subject.first_term.diem_thuong_xuyen1 }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>

                            <div class="thuong_xuyen diem"> 
                                {% if subject.first_term.diem_thuong_xuyen2 %}
                                {{ subject.first_term.diem_thuong_xuyen2 }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>

                            <div class="thuong_xuyen diem"> 
                                {% if subject.first_term.diem_thuong_xuyen3 %}
                                {{ subject.first_term.diem_thuong_xuyen3 }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>

                            <div class="thuong_xuyen diem"> 
                                {% if subject.first_term.diem_thuong_xuyen4 %}
                                {{ subject.first_term.diem_thuong_xuyen4 }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>

                            <div class="giua_ki diem"> 
                                {% if subject.first_term.diem_giua_ki %}
                                {{ subject.first_term.diem_giua_ki }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>

                            <div class="cuoi_ki diem"> 
                                {% if subject.first_term.diem_cuoi_ki %}
                                {{ subject.first_term.diem_cuoi_ki }} 
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>
                        </div>

                        <div>
                            <p class="term_headers">Kì 2</p>
                        </div>

                        <div class="marks">
                            <div class="thuong_xuyen diem"> 
                                {% if subject.second_term.diem_thuong_xuyen1 %}
                                {{ subject.second_term.diem_thuong_xuyen1 }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>

                            <div class="thuong_xuyen diem"> 
                                {% if subject.second_term.diem_thuong_xuyen2 %}
                                {{ subject.second_term.diem_thuong_xuyen2 }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>

                            <div class="thuong_xuyen diem"> 
                                {% if subject.second_term.diem_thuong_xuyen3 %}
                                {{ subject.second_term.diem_thuong_xuyen3 }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>

                            <div class="thuong_xuyen diem"> 
                                {% if subject.second_term.diem_thuong_xuyen4 %}
                                {{ subject.second_term.diem_thuong_xuyen4 }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>

                            <div class="giua_ki diem"> 
                                {% if subject.second_term.diem_giua_ki %}
                                {{ subject.second_term.diem_giua_ki }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>

                            <div class="cuoi_ki diem"> 
                                {% if subject.second_term.diem_cuoi_ki %}
                                {{ subject.second_term.diem_cuoi_ki }}
                                {% else %}
                                Chưa có điểm
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% empty %}
                Error while loading page
                {% endfor %}
                <!--** second subjects (2 thuong xuyen) -->
                {% for second_subject in student.get_subjects_mark.second %}
                    <div id="{{ second_subject.first_term.name }}" style="display: none;" class="subjectMarkDisplay">
                        <div class="subject_name_container">
                            <p class="subject_name"> {{ second_subject.name }} </p>
                        </div>
                        <div>
                            <p class="term_headers">Kì 1</p>
                        </div>
                        <div class="mark_table_headers">
                            <p>Điểm thường xuyên 1 </p>
                            <p>Điểm thường xuyên 2</p>
                            <p>Điểm giữa kì</p>
                            <p>Điểm cuối kì</p>
                        </div>
                        <div class="marks">
                            <div class="thuong_xuyen diem">
                                {% if second_subject.second_term.thuong_xuyen1 %}
                                    {{ second_subject.second_term.thuong_xuyen1 }}
                                {% else %}
                                    Chua co diem 
                                {% endif %}
                            </div>
                            <div class="thuong_xuyen diem">
                                {% if second_subject.second_term.thuong_xuyen2 %}
                                    {{ second_subject.second_term.thuong_xuyen2 }}
                                {% else %}
                                    Chua co diem 
                                {% endif %}
                            </div>
                            <div class="giua_ki diem">
                                {% if second_subject.second_term.giua_ki %}
                                    {{ second_subject.second_term.giua_ki }}
                                {% else %}
                                    Chua co diem 
                                {% endif %}
                            </div>
                            <div class="cuoi_ki diem">
                                {% if second_subject.second_term.cuoi_ki %}
                                    {{ second_subject.second_term.cuoi_ki }}
                                {% else %}
                                    Chua co diem 
                                {% endif %}
                            </div>
                        </div>

                        <div>
                            <p class="term_headers">Kì 2</p>
                        </div>

                        <div class="marks">
                            <div class="thuong_xuyen diem"></div>
                                {% if second_subject.second_term.thuong_xuyen1 %}
                                    {{ second_subject.second_term.thuong_xuyen1 }}
                                {% else %}
                                    Chua co diem 
                                {% endif %}
                            </div>

                            <div class="thuong_xuyen diem">
                                {% if second_subject.second_term.thuong_xuyen2 %}
                                    {{ second_subject.second_term.thuong_xuyen2 }}
                                {% else %}
                                    Chua co diem 
                                {% endif %}
                            </div>

                            <div class="giua_ki diem">
                                {% if second_subject.second_term.giua_ki %}
                                    {{ second_subject.second_term.giua_ki }}
                                {% else %}
                                    Chua co diem 
                                {% endif %}
                            </div>
                            
                            <div class="cuoi_ki diem">
                                {% if second_subject.second_term.cuoi_ki %}
                                    {{ second_subject.second_term.cuoi_ki }}
                                {% else %}
                                    Chua co diem 
                                {% endif %}
                            </div>
                    </div>
                {% empty %}
                Error while loading page
                {% endfor %}
                <!--* Display comment subjects-->
                <!--TODO: FIX-->
                {% for comment_subject in student.get_subjects_mark.comment %}
                    <div id="{{ comment_subject.first_term.name }}" style="display: none;">
                        <p>{% if comment_subject.is_passed == True %} Đạt {% elif comment_subject.is_passed == False %} Chưa đạt {% else %} Chưa có kết quả {% endif %} </p>
                        <p> {{ comment_subject.comment }} </p>
                    </div>
                {% endfor %}
                {% if user.teacher in student.get_profile.classroom.get_teachers %}
                <div class="updateMarkDiv">
                    <div id="updateMarkMesage">
                    </div>
                    <form id="updateMarkForm" data-student-id="{{ student.id }}">
                        <!--* teacher will select the subject that they want to update-->
                        <select>
                            <!-- TODO: update this so it still working in case the teacher teach mor ethan 1 subject -->

                            <option value="{% get_subject student_profile.classroom user.teacher '.id' %}" selected>{% get_subject student_profile.classroom user.teacher 'name' %}</option>
                        </select>
                        <!--*Select semester -->
                        <select id="semester">
                            <option value="1" selected>Kì 1</option>
                            <option value="2"> Kì 2</option>
                        </select>
                        <!--* Select mark type-->
                        <select id="markType">
                            <!--TODO: Update so only display possible type-->
                            <option selected disabled value="">Chọn cột điểm</option>
                            <option value="tx1">Thường xuyên 1</option>
                            <option value="tx2">Thường xuyên 2</option>
                            <option value="tx3">Thường xuyên 3</option>
                            <option value="tx4">Thường xuyên 4</option>
                            <option value="gk">Giữa Kì</option>
                            <option value="ck">Cuối kì</option>
                        </select>
                        <input type="number" id="new_mark" class="form-control mx-auto mb-2" placeholder="Điểm" step="0.01" max="10" min="0">
                        <button type="submit" class="btn btn-primary">Cập nhập điểm cho học sinh</button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}